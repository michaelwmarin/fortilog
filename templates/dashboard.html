{% extends "base.html" %}

{% block content %}
<div class="container-fluid p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary fw-bold">Visão Geral</h2>
        <span class="badge bg-light text-dark border p-2">
            <i class="bi bi-hdd-network me-1"></i> {{ sys_info.hostname }}
        </span>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card p-3 border-start border-4 border-primary shadow-sm">
                <h6 class="text-muted">TOTAL DE EVENTOS (24h)</h6>
                <h2 class="fw-bold text-primary">{{ total }}</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 border-start border-4 border-success shadow-sm">
                <h6 class="text-muted">TRÁFEGO PERMITIDO</h6>
                <h2 class="fw-bold text-success">{{ permitidos }}</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 border-start border-4 border-danger shadow-sm">
                <h6 class="text-muted">BLOQUEIOS / AMEAÇAS</h6>
                <h2 class="fw-bold text-danger">{{ bloqueados }}</h2>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-white fw-bold"><i class="bi bi-cpu"></i> Saúde do Servidor</div>
                <div class="card-body">
                    <div class="row text-center mt-3">
                        <div class="col-6 mb-3">
                            <h6 class="text-muted">CPU</h6>
                            <div class="position-relative d-inline-block">
                                <canvas id="cpuChart" width="120" height="120"></canvas>
                                <div class="position-absolute top-50 start-50 translate-middle fw-bold fs-4">{{ sys_info.cpu }}%</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <h6 class="text-muted">Memória RAM</h6>
                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: {{ sys_info.ram_percent }}%">
                                    {{ sys_info.ram_used }} GB
                                </div>
                            </div>
                            <small class="text-muted">{{ sys_info.ram_percent }}% em uso</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-white fw-bold"><i class="bi bi-pie-chart"></i> Dispositivos / OS</div>
                <div class="card-body">
                    <canvas id="osChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Gráfico de Pizza (Fabricantes)
    new Chart(document.getElementById('osChart'), {
        type: 'doughnut',
        data: {
            labels: {{ labels_fab | safe }},
            datasets: [{
                data: {{ values_fab | safe }},
                backgroundColor: ['#36b9cc', '#1cc88a', '#4e73df', '#f6c23e', '#e74a3b']
            }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
    });

    // Gráfico de CPU (Rosquinha simples)
    new Chart(document.getElementById('cpuChart'), {
        type: 'doughnut',
        data: {
            labels: ['Uso', 'Livre'],
            datasets: [{
                data: [{{ sys_info.cpu }}, {{ 100 - sys_info.cpu }}],
                backgroundColor: ['#e74a3b', '#f8f9fc'],
                borderWidth: 0
            }]
        },
        options: { cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false } } }
    });
</script>
{% endblock %}