<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Gerenciar Usuários</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #121212; font-family: 'Segoe UI', sans-serif; font-size: 0.85rem; color: #e0e0e0; overflow-x: hidden; }
        /* SIDEBAR */
        #wrapper { display: flex; width: 100%; }
        #sidebar-wrapper { width: 250px; background-color: #2a2d32; border-right: 1px solid #444; min-height: 100vh; position: fixed; z-index: 1000; }
        #page-content-wrapper { width: 100%; margin-left: 250px; padding: 20px; }
        .sidebar-brand { padding: 20px; font-size: 1.2rem; font-weight: bold; color: #fff; border-bottom: 1px solid #444; }
        .list-group-item { background: transparent; color: #ccc; border: none; padding: 12px 20px; transition: 0.2s; }
        .list-group-item:hover, .list-group-item.active { background-color: #3e4146; color: #fff; text-decoration: none; }
        .list-group-item i { width: 25px; margin-right: 10px; }
        .sidebar-footer { margin-top: auto; position: absolute; bottom: 0; width: 100%; padding: 20px; border-top: 1px solid #444; font-size: 0.8rem; color: #888; }
        /* CARDS & TABLES */
        .card-dash { background-color: #1e2125; border: 1px solid #333; margin-bottom: 20px; }
        .table-custom { --bs-table-bg: #1a1d21; --bs-table-color: #ccc; border-color: #373b3e; font-size: 0.85rem; }
        .table-custom thead th { background-color: #2a2d32; color: #fff; font-weight: 500; border-bottom: 2px solid #444; }
        .btn-del { color: #dc3545; background: none; border: none; cursor: pointer; }
        .btn-del:hover { color: #ff6b6b; }
    </style>
</head>
<body>
<div class="d-flex" id="wrapper">
    <div id="sidebar-wrapper">
        <div class="sidebar-brand"><i class="fa-solid fa-shield-halved text-primary me-2"></i> FortiLog</div>
        <div class="list-group list-group-flush">
            <a href="/" class="list-group-item"><i class="fa-solid fa-chart-line text-info"></i> Dashboard</a>
            <a href="/logs" class="list-group-item"><i class="fa-solid fa-table-list text-light"></i> Logs View</a>
            {% if session['role'] == 'ADM' %}
                <a href="/usuarios" class="list-group-item active"><i class="fa-solid fa-users-gear text-warning"></i> Usuários</a>
                <a href="/dispositivos" class="list-group-item"><i class="fa-solid fa-laptop text-success"></i> Dispositivos</a>
                <a href="/destinos" class="list-group-item"><i class="fa-solid fa-globe text-primary"></i> Destinos</a>
            {% endif %}
        </div>
        <div class="sidebar-footer">
            <div class="mb-2"><i class="fa-solid fa-clock"></i> Uptime: {{ sys_info.uptime }}</div>
            <div class="mb-3"><i class="fa-solid fa-hard-drive"></i> Disk: {{ sys_info.disk }}</div>
            <a href="/logout" class="btn btn-outline-danger btn-sm w-100"><i class="fa-solid fa-power-off"></i> Sair</a>
        </div>
    </div>

    <div id="page-content-wrapper">
        <h4 class="mb-4 text-warning"><i class="fa-solid fa-users-gear me-2"></i>Gerenciar Usuários</h4>
        
        {% if msg %}
        <div class="alert alert-success alert-dismissible fade show shadow-sm">
            <i class="fa-solid fa-check-circle me-2"></i> {{ msg }} 
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        <div class="card card-dash">
            <div class="card-body">
                <form method="POST" class="row g-2 align-items-center">
                    <input type="hidden" name="action" value="add">
                    <div class="col-md-4">
                        <input type="text" name="new_user" class="form-control bg-dark border-secondary text-light" placeholder="Usuário" required>
                    </div>
                    <div class="col-md-4">
                        <input type="password" name="new_pass" class="form-control bg-dark border-secondary text-light" placeholder="Senha" required>
                    </div>
                    <div class="col-md-2">
                        <select name="new_role" class="form-select bg-dark border-secondary text-light">
                            <option value="VIEWER">Visualizador</option>
                            <option value="ADM">Administrador</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-warning w-100 fw-bold">Criar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-custom table-hover align-middle">
                <thead>
                    <tr><th>Usuário</th><th>Permissão</th><th class="text-end">Ação</th></tr>
                </thead>
                <tbody>
                    {% for u, dados in users.items() %}
                    <tr>
                        <td><i class="fa-solid fa-user me-2 text-secondary"></i> {{ u }}</td>
                        <td>
                            {% if dados.role == 'ADM' %}<span class="badge bg-danger">ADMIN</span>
                            {% else %}<span class="badge bg-secondary">VIEWER</span>{% endif %}
                        </td>
                        <td class="text-end">
                            {% if u != 'FortiLog' %}
                            <form method="POST" class="d-inline">
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="del_user" value="{{ u }}">
                                <button type="submit" class="btn-del" title="Excluir"><i class="fa-solid fa-trash"></i></button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>